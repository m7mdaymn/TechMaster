import{a as I}from"./chunk-ZAODAAZN.js";import{a as z,b as N,c as u,d as A,e as j,h as D,k as R,l as V,s as $,u as B}from"./chunk-HRUO5R4Q.js";import{a as F}from"./chunk-QFQZ7TF5.js";import"./chunk-XAZLOLJU.js";import{a as M}from"./chunk-JLLNXAHD.js";import{c as G,d as T}from"./chunk-SAC5YDHM.js";import"./chunk-AJDLSE77.js";import"./chunk-L2ZR2CCC.js";import{$a as f,Ab as i,Bb as S,Jb as L,Na as c,W as m,Wa as h,Y as k,cb as _,eb as P,gb as C,ia as O,ja as y,lb as e,mb as t,mc as E,nb as p,pa as x,sb as b}from"./chunk-Q5RFH5SI.js";function H(l,v){l&1&&(e(0,"span",13),i(1,"Email is required"),t())}function W(l,v){l&1&&(e(0,"span",13),i(1,"Password is required"),t())}function q(l,v){l&1&&p(0,"span",23)}function U(l,v){l&1&&i(0," Sign In ")}var re=(()=>{class l{fb=m($);authService=m(I);router=m(G);toastr=m(F);ngZone=m(x);showPassword=h(!1);isLoading=h(!1);googleLoading=h(!1);loginForm=this.fb.group({email:["",[u.required,u.email]],password:["",[u.required,u.minLength(6)]],rememberMe:[!1]});ngAfterViewInit(){this.initializeGoogleSignIn()}initializeGoogleSignIn(){let r=setInterval(()=>{typeof google<"u"&&google.accounts&&(clearInterval(r),google.accounts.id.initialize({client_id:M.googleClientId,callback:a=>this.handleGoogleCallback(a),auto_select:!1,cancel_on_tap_outside:!0}))},100);setTimeout(()=>clearInterval(r),1e4)}handleGoogleCallback(r){this.ngZone.run(()=>{r.credential&&this.processGoogleToken(r.credential)})}togglePassword(){this.showPassword.update(r=>!r)}onSubmit(){if(this.loginForm.invalid){Object.keys(this.loginForm.controls).forEach(n=>{this.loginForm.get(n)?.markAsTouched()});return}this.isLoading.set(!0);let{email:r,password:a,rememberMe:o}=this.loginForm.value;this.authService.login({email:r,password:a,rememberMe:o}).subscribe({next:n=>{if(console.log("Login response:",n),console.log("Token received:",!!n.token),console.log("Token value (first 50 chars):",n.token?.substring(0,50)),n.isSuccess&&n.user&&n.token){let g=localStorage.getItem("techmaster_token");console.log("Token saved to localStorage:",!!g);let s=n.user.role;console.log("User role:",s),setTimeout(()=>{this.isLoading.set(!1),s==="Admin"?this.router.navigate(["/admin/dashboard"]):s==="Instructor"?this.router.navigate(["/instructor/dashboard"]):this.router.navigate(["/student/dashboard"])},100)}else this.isLoading.set(!1),this.toastr.error(n.message||"Login failed")},error:n=>{this.isLoading.set(!1),console.error("Login error:",n),this.toastr.error(n.error?.message||"Login failed")}})}loginWithGoogle(){if(typeof google>"u"||!google.accounts){this.toastr.error("Google Sign-In is not available. Please refresh the page and try again.");return}google.accounts.id.prompt(r=>{r.isNotDisplayed()?(console.log("Google prompt not displayed:",r.getNotDisplayedReason()),this.openGoogleSignInPopup()):r.isSkippedMoment()&&(console.log("Google prompt skipped:",r.getSkippedReason()),this.openGoogleSignInPopup())})}openGoogleSignInPopup(){let o=window.screenX+(window.outerWidth-500)/2,n=window.screenY+(window.outerHeight-600)/2,g=window.open(`https://accounts.google.com/o/oauth2/v2/auth?client_id=${M.googleClientId}&redirect_uri=${window.location.origin}/auth/google/callback&response_type=token%20id_token&scope=email%20profile%20openid&nonce=${Math.random().toString(36).substring(7)}`,"GoogleSignIn",`width=500,height=600,left=${o},top=${n}`),s=setInterval(()=>{try{if(g?.closed)clearInterval(s);else if(g?.location?.hash){let d=g.location.hash.substring(1),w=new URLSearchParams(d).get("id_token");w&&(clearInterval(s),g.close(),this.processGoogleToken(w))}}catch{}},500);setTimeout(()=>clearInterval(s),12e4)}processGoogleToken(r){this.googleLoading.set(!0),this.isLoading.set(!0),this.authService.googleLogin(r).subscribe({next:a=>{if(this.googleLoading.set(!1),this.isLoading.set(!1),a.isSuccess&&a.user&&a.token){let o=a.user.role;this.toastr.success("Successfully signed in with Google!"),setTimeout(()=>{o==="Admin"?this.router.navigate(["/admin/dashboard"]):o==="Instructor"?this.router.navigate(["/instructor/dashboard"]):this.router.navigate(["/student/dashboard"])},100)}else this.toastr.error(a.message||"Google login failed")},error:a=>{this.googleLoading.set(!1),this.isLoading.set(!1),console.error("Google login error:",a),this.toastr.error(a.error?.message||"Google login failed")}})}static \u0275fac=function(a){return new(a||l)};static \u0275cmp=k({type:l,selectors:[["app-login"]],standalone:!0,features:[L],decls:67,vars:11,consts:[[1,"auth-page"],[1,"auth-container"],[1,"auth-card"],[1,"auth-header"],["routerLink","/",1,"auth-logo"],[1,"logo-text"],[1,"highlight"],[1,"auth-form",3,"ngSubmit","formGroup"],[1,"form-group"],["for","email"],[1,"input-wrapper"],[1,"material-icons"],["type","email","id","email","formControlName","email","placeholder","Enter your email"],[1,"error-text"],["for","password"],["id","password","formControlName","password","placeholder","Enter your password",3,"type"],["type","button",1,"toggle-password",3,"click"],[1,"form-options"],[1,"checkbox-label"],["type","checkbox","formControlName","rememberMe"],[1,"checkmark"],["routerLink","/auth/forgot-password",1,"forgot-link"],["type","submit",1,"btn","btn-primary","btn-lg","btn-block",3,"disabled"],[1,"spinner"],[1,"auth-divider"],["type","button",1,"btn","btn-google",3,"click"],["viewBox","0 0 24 24","width","20","height","20"],["fill","#4285F4","d","M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"],["fill","#34A853","d","M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"],["fill","#FBBC05","d","M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"],["fill","#EA4335","d","M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"],[1,"auth-footer"],["routerLink","/",1,"home-link"],[1,"signup-link"],["routerLink","/auth/register"],[1,"auth-background"],[1,"background-content"]],template:function(a,o){if(a&1&&(e(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"a",4)(5,"span",5),i(6,"Tech"),e(7,"span",6),i(8,"Master"),t()()(),e(9,"h1"),i(10,"Welcome Back"),t(),e(11,"p"),i(12,"Sign in to continue your learning journey"),t()(),e(13,"form",7),b("ngSubmit",function(){return o.onSubmit()}),e(14,"div",8)(15,"label",9),i(16,"Email"),t(),e(17,"div",10)(18,"span",11),i(19,"email"),t(),p(20,"input",12),t(),f(21,H,2,0,"span",13),t(),e(22,"div",8)(23,"label",14),i(24,"Password"),t(),e(25,"div",10)(26,"span",11),i(27,"lock"),t(),p(28,"input",15),e(29,"button",16),b("click",function(){return o.togglePassword()}),e(30,"span",11),i(31),t()()(),f(32,W,2,0,"span",13),t(),e(33,"div",17)(34,"label",18),p(35,"input",19)(36,"span",20),i(37," Remember me "),t(),e(38,"a",21),i(39," Forgot Password? "),t()(),e(40,"button",22),f(41,q,1,0,"span",23)(42,U,1,0),t()(),e(43,"div",24)(44,"span"),i(45,"or"),t()(),e(46,"button",25),b("click",function(){return o.loginWithGoogle()}),O(),e(47,"svg",26),p(48,"path",27)(49,"path",28)(50,"path",29)(51,"path",30),t(),i(52," Continue with Google "),t(),y(),e(53,"div",31)(54,"a",32),i(55,"\u2190 Back to Home"),t(),e(56,"div",33)(57,"span"),i(58,"Don't have an account?"),t(),e(59,"a",34),i(60,"Sign Up"),t()()()()(),e(61,"div",35)(62,"div",36)(63,"h2"),i(64,"Welcome to TechMaster"),t(),e(65,"p"),i(66,"The #1 Tech Education Platform in the Arab World"),t()()()()),a&2){let n,g,s,d;c(13),_("formGroup",o.loginForm),c(7),P("error",((n=o.loginForm.get("email"))==null?null:n.invalid)&&((n=o.loginForm.get("email"))==null?null:n.touched)),c(),C((g=o.loginForm.get("email"))!=null&&g.invalid&&((g=o.loginForm.get("email"))!=null&&g.touched)?21:-1),c(7),P("error",((s=o.loginForm.get("password"))==null?null:s.invalid)&&((s=o.loginForm.get("password"))==null?null:s.touched)),_("type",o.showPassword()?"text":"password"),c(3),S(o.showPassword()?"visibility_off":"visibility"),c(),C((d=o.loginForm.get("password"))!=null&&d.invalid&&((d=o.loginForm.get("password"))!=null&&d.touched)?32:-1),c(8),_("disabled",o.isLoading()),c(),C(o.isLoading()?41:42)}},dependencies:[E,T,B,D,N,z,A,j,R,V],styles:['.auth-page[_ngcontent-%COMP%]{min-height:100vh;display:flex}.auth-container[_ngcontent-%COMP%]{flex:1;display:flex;align-items:center;justify-content:center;padding:2rem;background:var(--color-white)}.auth-card[_ngcontent-%COMP%]{width:100%;max-width:420px}.auth-header[_ngcontent-%COMP%]{text-align:center;margin-bottom:2rem}.auth-logo[_ngcontent-%COMP%]{display:inline-block;margin-bottom:1.5rem;text-decoration:none}.logo-text[_ngcontent-%COMP%]{font-size:2rem;font-weight:800;color:var(--color-dark)}.logo-text[_ngcontent-%COMP%]   .highlight[_ngcontent-%COMP%]{color:var(--color-primary)}.auth-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.75rem;font-weight:700;color:var(--color-dark);margin-bottom:.5rem}.auth-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--color-gray-600)}.auth-form[_ngcontent-%COMP%]{margin-bottom:1.5rem}.form-group[_ngcontent-%COMP%]{margin-bottom:1.25rem}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;font-weight:500;margin-bottom:.5rem;color:var(--color-dark)}.input-wrapper[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center}.input-wrapper[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{position:absolute;left:1rem;color:var(--color-gray-400);font-size:1.25rem}.input-wrapper[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;padding:.875rem 1rem .875rem 3rem;border:2px solid var(--color-gray-200);border-radius:10px;font-size:1rem;transition:all .3s ease}.input-wrapper[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{border-color:var(--color-primary);outline:none;box-shadow:0 0 0 3px #2470901a}.input-wrapper[_ngcontent-%COMP%]   input.error[_ngcontent-%COMP%]{border-color:#ef4444}.toggle-password[_ngcontent-%COMP%]{position:absolute;right:1rem;background:none;border:none;cursor:pointer;color:var(--color-gray-400);padding:0}.toggle-password[_ngcontent-%COMP%]:hover{color:var(--color-gray-600)}.error-text[_ngcontent-%COMP%]{display:block;margin-top:.5rem;font-size:.875rem;color:#ef4444}.form-options[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem}.checkbox-label[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;cursor:pointer;font-size:.875rem;color:var(--color-gray-600)}.checkbox-label[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{width:18px;height:18px;accent-color:var(--color-primary)}.forgot-link[_ngcontent-%COMP%]{font-size:.875rem;color:var(--color-primary);text-decoration:none;font-weight:500}.forgot-link[_ngcontent-%COMP%]:hover{text-decoration:underline}.btn-block[_ngcontent-%COMP%]{width:100%}.spinner[_ngcontent-%COMP%]{width:20px;height:20px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.auth-divider[_ngcontent-%COMP%]{display:flex;align-items:center;margin:1.5rem 0}.auth-divider[_ngcontent-%COMP%]:before, .auth-divider[_ngcontent-%COMP%]:after{content:"";flex:1;height:1px;background:var(--color-gray-200)}.auth-divider[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{padding:0 1rem;color:var(--color-gray-500);font-size:.875rem}.btn-google[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;justify-content:center;gap:.75rem;padding:.875rem;background:var(--color-white);border:2px solid var(--color-gray-200);border-radius:10px;font-size:1rem;font-weight:500;color:var(--color-dark);cursor:pointer;transition:all .3s ease}.btn-google[_ngcontent-%COMP%]:hover{background:var(--color-gray-50);border-color:var(--color-gray-300)}.auth-footer[_ngcontent-%COMP%]{text-align:center;margin-top:1.5rem;font-size:.875rem;color:var(--color-gray-600)}.home-link[_ngcontent-%COMP%]{display:block;color:var(--color-primary);font-weight:600;text-decoration:none;margin-bottom:1rem}.home-link[_ngcontent-%COMP%]:hover{text-decoration:underline}.signup-link[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--color-primary);font-weight:600;text-decoration:none;margin-left:.25rem}.signup-link[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline}.auth-background[_ngcontent-%COMP%]{flex:1;display:none;background:linear-gradient(135deg,var(--color-dark) 0%,#1a1a1a 50%,var(--color-primary) 100%);position:relative;overflow:hidden}.background-content[_ngcontent-%COMP%]{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;color:var(--color-white);text-align:center;padding:2rem}.background-content[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:2.5rem;font-weight:800;margin-bottom:1rem}.background-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1.25rem;opacity:.9}@media (min-width: 1024px){.auth-background[_ngcontent-%COMP%]{display:block}}[dir=rtl][_nghost-%COMP%]   .input-wrapper[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%], [dir=rtl]   [_nghost-%COMP%]   .input-wrapper[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{left:auto;right:1rem}[dir=rtl][_nghost-%COMP%]   .input-wrapper[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], [dir=rtl]   [_nghost-%COMP%]   .input-wrapper[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding:.875rem 3rem .875rem 1rem}[dir=rtl][_nghost-%COMP%]   .toggle-password[_ngcontent-%COMP%], [dir=rtl]   [_nghost-%COMP%]   .toggle-password[_ngcontent-%COMP%]{right:auto;left:1rem}[dir=rtl][_nghost-%COMP%]   .auth-footer[_ngcontent-%COMP%]   a[_ngcontent-%COMP%], [dir=rtl]   [_nghost-%COMP%]   .auth-footer[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{margin-left:0;margin-right:.25rem}']})}return l})();export{re as LoginComponent};
