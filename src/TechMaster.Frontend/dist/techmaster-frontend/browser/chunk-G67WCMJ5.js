import{a as A}from"./chunk-SWJOSVLM.js";import{b as j,d as $,g as U,t as D}from"./chunk-HRUO5R4Q.js";import{a as N}from"./chunk-QFQZ7TF5.js";import"./chunk-XAZLOLJU.js";import"./chunk-JLLNXAHD.js";import"./chunk-AJDLSE77.js";import"./chunk-L2ZR2CCC.js";import{$a as p,Ab as r,Bb as d,Cb as P,Fb as I,Gb as E,Hb as T,Ja as y,Jb as k,Mb as R,Na as a,Pb as z,W as C,Wa as f,Y as w,cb as h,eb as b,ga as _,gb as g,ha as x,jb as M,kb as v,lb as n,lc as F,mb as i,mc as V,nb as S,qb as O,sb as u,tb as l}from"./chunk-Q5RFH5SI.js";var W=(t,c)=>c.id;function B(t,c){if(t&1&&(n(0,"span",15),r(1),R(2,"slice"),i()),t&2){let e=l().$implicit;a(),P("",z(2,1,e.lastMessage.content,0,40),"...")}}function L(t,c){if(t&1&&(n(0,"span",16),r(1),i()),t&2){let e=l().$implicit;a(),d(e.unreadCount)}}function J(t,c){if(t&1){let e=O();n(0,"div",10),u("click",function(){let s=_(e).$implicit,m=l();return x(m.selectRoom(s))}),n(1,"div",11)(2,"span",12),r(3,"groups"),i()(),n(4,"div",13)(5,"span",14),r(6),i(),p(7,B,3,5,"span",15),i(),p(8,L,2,1,"span",16),i()}if(t&2){let e,o=c.$implicit,s=l();b("active",((e=s.selectedRoom())==null?null:e.id)===o.id),a(6),d(o.name),a(),g(o.lastMessage?7:-1),a(),g(o.unreadCount>0?8:-1)}}function q(t,c){t&1&&(n(0,"div",7)(1,"span",12),r(2,"forum"),i(),n(3,"p"),r(4,"No chat rooms yet"),i()())}function G(t,c){if(t&1&&(n(0,"span",19),r(1),i()),t&2){let e,o=l(2);a(),d((e=o.selectedRoom())==null?null:e.courseName)}}function H(t,c){if(t&1&&S(0,"img",34),t&2){let e=l(2).$implicit;h("src",e.senderPhotoUrl,y)}}function K(t,c){if(t&1&&(n(0,"span"),r(1),i()),t&2){let e=l(2).$implicit;a(),d(e.senderName.charAt(0))}}function Q(t,c){if(t&1&&(n(0,"div",29),p(1,H,1,1,"img",34)(2,K,2,1,"span"),i()),t&2){let e=l().$implicit;a(),g(e.senderPhotoUrl?1:2)}}function X(t,c){if(t&1&&(n(0,"span",31),r(1),i()),t&2){let e=l().$implicit;a(),d(e.senderName)}}function Y(t,c){if(t&1&&(n(0,"div",28),p(1,Q,3,1,"div",29),n(2,"div",30),p(3,X,2,1,"span",31),n(4,"div",32),r(5),i(),n(6,"span",33),r(7),i()()()),t&2){let e=c.$implicit,o=l(2);b("own",o.isOwnMessage(e)),a(),g(o.isOwnMessage(e)?-1:1),a(2),g(o.isOwnMessage(e)?-1:3),a(2),d(e.content),a(2),d(o.formatTime(e.createdAt))}}function Z(t,c){t&1&&(n(0,"div",24)(1,"span",12),r(2,"chat_bubble_outline"),i(),n(3,"p"),r(4,"No messages yet. Start the conversation!"),i()())}function ee(t,c){if(t&1){let e=O();n(0,"div",17)(1,"div",18)(2,"h3"),r(3),i(),p(4,G,2,1,"span",19),i(),n(5,"div",20)(6,"span",21)(7,"span",12),r(8,"people"),i(),r(9),i()()(),n(10,"div",22,0),M(12,Y,8,6,"div",23,W,!1,Z,5,0,"div",24),i(),n(15,"div",25)(16,"input",26),T("ngModelChange",function(s){_(e);let m=l();return E(m.newMessage,s)||(m.newMessage=s),x(s)}),u("keyup.enter",function(){_(e);let s=l();return x(s.sendMessage())}),i(),n(17,"button",27),u("click",function(){_(e);let s=l();return x(s.sendMessage())}),n(18,"span",12),r(19,"send"),i()()()}if(t&2){let e,o,s,m=l();a(3),d((e=m.selectedRoom())==null?null:e.name),a(),g((o=m.selectedRoom())!=null&&o.courseName?4:-1),a(5),P(" ",(s=m.selectedRoom())==null?null:s.participantCount," participants "),a(3),v(m.messages()),a(4),I("ngModel",m.newMessage),a(),h("disabled",!m.newMessage.trim())}}function te(t,c){t&1&&(n(0,"div",9)(1,"span",12),r(2,"chat"),i(),n(3,"h3"),r(4,"Select a conversation"),i(),n(5,"p"),r(6,"Choose a chat room from the sidebar to start messaging"),i()())}var de=(()=>{class t{instructorService=C(A);toastr=C(N);chatRooms=f([]);selectedRoom=f(null);messages=f([]);newMessage="";currentUserId="";ngOnInit(){this.loadChatRooms();let e=localStorage.getItem("currentUser");e&&(this.currentUserId=JSON.parse(e).id)}loadChatRooms(){this.instructorService.getChatRooms().subscribe(e=>{this.chatRooms.set(e)})}selectRoom(e){this.selectedRoom.set(e),this.loadMessages(e.id)}loadMessages(e){this.instructorService.getChatMessages(e).subscribe(o=>{this.messages.set(o)})}sendMessage(){if(!this.newMessage.trim()||!this.selectedRoom())return;let e=this.selectedRoom().id;this.instructorService.sendMessage(e,this.newMessage).subscribe(o=>{o&&(this.messages.update(s=>[...s,o]),this.newMessage="")})}isOwnMessage(e){return e.senderId===this.currentUserId}formatTime(e){return new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}static \u0275fac=function(o){return new(o||t)};static \u0275cmp=w({type:t,selectors:[["app-instructor-chat"]],standalone:!0,features:[k],decls:13,vars:2,consts:[["messagesContainer",""],[1,"chat-page"],[1,"chat-container"],[1,"rooms-sidebar"],[1,"sidebar-header"],[1,"rooms-list"],[1,"room-item",3,"active"],[1,"empty-rooms"],[1,"chat-main"],[1,"no-room-selected"],[1,"room-item",3,"click"],[1,"room-avatar"],[1,"material-icons"],[1,"room-info"],[1,"room-name"],[1,"last-message"],[1,"unread-badge"],[1,"chat-header"],[1,"chat-title"],[1,"course-name"],[1,"chat-actions"],[1,"participant-count"],[1,"messages-container"],[1,"message",3,"own"],[1,"no-messages"],[1,"message-input"],["type","text","placeholder","Type a message...",3,"ngModelChange","keyup.enter","ngModel"],[1,"send-btn",3,"click","disabled"],[1,"message"],[1,"message-avatar"],[1,"message-content"],[1,"sender-name"],[1,"message-bubble"],[1,"message-time"],["alt","",3,"src"]],template:function(o,s){o&1&&(n(0,"div",1)(1,"div",2)(2,"aside",3)(3,"div",4)(4,"h2"),r(5,"Messages"),i()(),n(6,"div",5),M(7,J,9,5,"div",6,W,!1,q,5,0,"div",7),i()(),n(10,"main",8),p(11,ee,20,6)(12,te,7,0,"div",9),i()()()),o&2&&(a(7),v(s.chatRooms()),a(4),g(s.selectedRoom()?11:12))},dependencies:[V,F,D,j,$,U],styles:[".chat-page[_ngcontent-%COMP%]{height:calc(100vh - 140px);margin:-32px}.chat-container[_ngcontent-%COMP%]{display:flex;height:100%;background:#fff}.rooms-sidebar[_ngcontent-%COMP%]{width:320px;border-right:1px solid #e2e8f0;display:flex;flex-direction:column}.sidebar-header[_ngcontent-%COMP%]{padding:20px;border-bottom:1px solid #e2e8f0}.sidebar-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600;margin:0}.rooms-list[_ngcontent-%COMP%]{flex:1;overflow-y:auto}.room-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:16px 20px;cursor:pointer;transition:background .2s;border-bottom:1px solid #f1f5f9}.room-item[_ngcontent-%COMP%]:hover{background:#f8fafc}.room-item.active[_ngcontent-%COMP%]{background:#eff6ff;border-left:3px solid #3b82f6}.room-avatar[_ngcontent-%COMP%]{width:48px;height:48px;border-radius:50%;background:linear-gradient(135deg,#10b981,#059669);display:flex;align-items:center;justify-content:center;color:#fff}.room-info[_ngcontent-%COMP%]{flex:1;min-width:0}.room-name[_ngcontent-%COMP%]{display:block;font-weight:600;color:#1e293b;margin-bottom:4px}.last-message[_ngcontent-%COMP%]{display:block;font-size:.85rem;color:#64748b;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.unread-badge[_ngcontent-%COMP%]{background:#ef4444;color:#fff;font-size:.75rem;padding:2px 8px;border-radius:10px;font-weight:600}.empty-rooms[_ngcontent-%COMP%]{text-align:center;padding:3rem;color:#64748b}.empty-rooms[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:48px;opacity:.5}.chat-main[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column}.chat-header[_ngcontent-%COMP%]{padding:16px 24px;border-bottom:1px solid #e2e8f0;display:flex;justify-content:space-between;align-items:center}.chat-title[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.1rem;font-weight:600;margin:0 0 4px}.course-name[_ngcontent-%COMP%]{font-size:.85rem;color:#64748b}.participant-count[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px;font-size:.9rem;color:#64748b}.participant-count[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:18px}.messages-container[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:24px;display:flex;flex-direction:column;gap:16px}.message[_ngcontent-%COMP%]{display:flex;gap:12px;max-width:70%}.message.own[_ngcontent-%COMP%]{margin-left:auto;flex-direction:row-reverse}.message-avatar[_ngcontent-%COMP%]{width:36px;height:36px;border-radius:50%;background:#e2e8f0;display:flex;align-items:center;justify-content:center;font-weight:600;font-size:.9rem;color:#64748b;flex-shrink:0;overflow:hidden}.message-avatar[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.message-content[_ngcontent-%COMP%]{display:flex;flex-direction:column}.sender-name[_ngcontent-%COMP%]{font-size:.8rem;font-weight:600;color:#64748b;margin-bottom:4px}.message-bubble[_ngcontent-%COMP%]{background:#f1f5f9;padding:12px 16px;border-radius:4px 16px 16px;color:#1e293b;line-height:1.4}.message.own[_ngcontent-%COMP%]   .message-bubble[_ngcontent-%COMP%]{background:linear-gradient(135deg,#10b981,#059669);color:#fff;border-radius:16px 4px 16px 16px}.message-time[_ngcontent-%COMP%]{font-size:.75rem;color:#94a3b8;margin-top:4px}.message.own[_ngcontent-%COMP%]   .message-time[_ngcontent-%COMP%]{text-align:right}.no-messages[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;color:#94a3b8}.no-messages[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:64px;opacity:.5;margin-bottom:16px}.message-input[_ngcontent-%COMP%]{padding:16px 24px;border-top:1px solid #e2e8f0;display:flex;gap:12px}.message-input[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{flex:1;padding:12px 16px;border:1px solid #e2e8f0;border-radius:24px;font-size:1rem;outline:none;transition:border-color .2s}.message-input[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{border-color:#10b981}.send-btn[_ngcontent-%COMP%]{width:48px;height:48px;border-radius:50%;background:linear-gradient(135deg,#10b981,#059669);border:none;color:#fff;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:transform .2s}.send-btn[_ngcontent-%COMP%]:hover:not(:disabled){transform:scale(1.05)}.send-btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.no-room-selected[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;color:#94a3b8}.no-room-selected[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:80px;opacity:.3;margin-bottom:16px}.no-room-selected[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#64748b;margin-bottom:8px}"]})}return t})();export{de as InstructorChatComponent};
