import{a as X}from"./chunk-WSIKJMH2.js";import{b as W,d as Y}from"./chunk-KRVVGRJQ.js";import{b as G,d as H,g as J,t as K}from"./chunk-HRUO5R4Q.js";import{a as q}from"./chunk-QFQZ7TF5.js";import"./chunk-XAZLOLJU.js";import"./chunk-JLLNXAHD.js";import"./chunk-AJDLSE77.js";import"./chunk-L2ZR2CCC.js";import{$a as w,Ab as r,Bb as f,Cb as x,Db as R,Eb as L,Fb as D,Gb as V,Hb as T,Jb as j,Mb as _,Na as o,Nb as b,Ob as A,W as v,Wa as P,Y as I,cb as M,eb as y,fb as z,ga as p,gb as E,ha as g,hc as B,ib as N,ic as $,jb as S,jc as U,kb as O,lb as i,mb as n,mc as Q,qb as h,sb as l,tb as d}from"./chunk-Q5RFH5SI.js";var ee=(s,m)=>m.value,te=(s,m)=>m.id;function ie(s,m){if(s&1){let e=h();i(0,"button",25),l("click",function(){let t=p(e).$implicit,c=d();return g(c.setStatus(t.value))}),r(1),n()}if(s&2){let e=m.$implicit,a=d();y("active",a.activeStatus===e.value),o(),x(" ",e.label," ")}}function ne(s,m){if(s&1&&(i(0,"span",37),r(1),n()),s&2){let e=d().$implicit;o(),x("Score: ",e.finalScore,"%")}}function re(s,m){if(s&1){let e=h();i(0,"button",38),l("click",function(){p(e);let t=d().$implicit,c=d();return g(c.revokeCertificate(t))}),r(1,"\u{1F6AB}"),n()}}function ae(s,m){if(s&1){let e=h();i(0,"tr")(1,"td")(2,"span",26),r(3),n()(),i(4,"td")(5,"div",27)(6,"span",28),r(7),n()()(),i(8,"td")(9,"div",29)(10,"span",30),r(11),n(),w(12,ne,2,1,"span",31),n()(),i(13,"td"),r(14),_(15,"date"),n(),i(16,"td"),r(17),n(),i(18,"td")(19,"span",32),r(20),n()(),i(21,"td")(22,"div",33)(23,"button",34),l("click",function(){let t=p(e).$implicit,c=d();return g(c.viewCertificate(t))}),r(24,"\u{1F441}\uFE0F"),n(),i(25,"button",35),l("click",function(){let t=p(e).$implicit,c=d();return g(c.verifyCertificate(t))}),r(26,"\u{1F50D}"),n(),w(27,re,2,0,"button",36),n()()()}if(s&2){let e=m.$implicit;o(3),f(e.certificateNumber),o(4),f(e.userName),o(4),f(e.courseName),o(),M("ngIf",e.finalScore),o(2),f(A(15,11,e.issuedAt,"mediumDate")),o(3),R("",e.finalScore||"N/A","",e.finalScore?"%":"",""),o(2),z(e.isValid?"valid":"revoked"),o(),x(" ",e.isValid?"Valid":"Revoked"," "),o(7),E(e.isValid?27:-1)}}function oe(s,m){s&1&&(i(0,"tr")(1,"td",39)(2,"span"),r(3,"\u{1F3C6}"),n(),i(4,"p"),r(5,"No certificates found"),n()()())}function ce(s,m){if(s&1){let e=h();i(0,"button",25),l("click",function(){let t=p(e).$implicit,c=d();return g(c.goToPage(t))}),r(1),n()}if(s&2){let e=m.$implicit,a=d();y("active",e===a.currentPage),o(),f(e)}}function se(s,m){if(s&1){let e=h();i(0,"div",40),l("click",function(){p(e);let t=d();return g(t.closeModal())}),i(1,"div",41),l("click",function(t){return p(e),g(t.stopPropagation())}),i(2,"div",42)(3,"h2"),r(4,"Certificate Preview"),n(),i(5,"button",43),l("click",function(){p(e);let t=d();return g(t.closeModal())}),r(6,"\xD7"),n()(),i(7,"div",44)(8,"div",45)(9,"div",46)(10,"div",47)(11,"h3"),r(12,"TechMaster"),n(),i(13,"p"),r(14,"Certificate of Completion"),n()(),i(15,"div",48)(16,"p",49),r(17,"This is to certify that"),n(),i(18,"h2",50),r(19),n(),i(20,"p",49),r(21,"has successfully completed"),n(),i(22,"h3",51),r(23),n()(),i(24,"div",52)(25,"div",53)(26,"span"),r(27),_(28,"date"),n(),i(29,"span"),r(30),n()()()()()(),i(31,"div",54)(32,"button",55),l("click",function(){p(e);let t=d();return g(t.downloadCertificate(t.selectedCertificate))}),i(33,"span"),r(34,"\u{1F4E5}"),n(),r(35," Download Certificate "),n()()()()}if(s&2){let e=d();o(19),f(e.selectedCertificate.userName),o(4),f(e.selectedCertificate.courseName),o(4),x("Issued Date: ",A(28,4,e.selectedCertificate.issueDate,"mediumDate"),""),o(3),x("Certificate Number: ",e.selectedCertificate.certificateNumber,"")}}var xe=(()=>{class s{translate=v(W);certificateService=v(X);toastr=v(q);certificates=P([]);filteredCertificates=P([]);isLoading=P(!1);searchQuery="";activeStatus="all";dateFilter="";currentPage=1;pageSize=20;totalCount=0;totalPages=1;totalCertificates=0;validCertificates=0;thisMonthCertificates=0;revokedCertificates=0;showPreviewModal=!1;selectedCertificate=null;Math=Math;statusTabs=[{value:"all",label:"All"},{value:"Valid",label:"Valid"},{value:"Revoked",label:"Revoked"}];ngOnInit(){this.loadCertificates()}loadCertificates(){this.isLoading.set(!0);let e={pageNumber:this.currentPage,pageSize:this.pageSize};this.searchQuery&&(e.search=this.searchQuery),this.activeStatus==="Valid"?e.isValid=!0:this.activeStatus==="Revoked"&&(e.isValid=!1),this.certificateService.getAllCertificates(e).subscribe({next:a=>{this.certificates.set(a.items),this.totalCount=a.totalCount,this.totalPages=a.totalPages||Math.ceil(a.totalCount/this.pageSize),this.calculateStats(),this.filterCertificates(),this.isLoading.set(!1)},error:()=>{this.toastr.error("Failed to load certificates"),this.isLoading.set(!1)}})}calculateStats(){let e=this.certificates(),a=new Date,t=new Date(a.getFullYear(),a.getMonth(),1);this.totalCertificates=this.totalCount||e.length,this.validCertificates=e.filter(c=>c.isValid).length,this.revokedCertificates=e.filter(c=>!c.isValid).length,this.thisMonthCertificates=e.filter(c=>new Date(c.issuedAt)>=t).length}setStatus(e){this.activeStatus=e,this.currentPage=1,this.loadCertificates()}onSearchChange(){this.currentPage=1,this.loadCertificates()}filterCertificates(){let e=this.certificates();if(this.dateFilter){let a=new Date(this.dateFilter);e=e.filter(t=>new Date(t.issuedAt)>=a)}this.filteredCertificates.set(e)}viewCertificate(e){this.selectedCertificate=e,this.showPreviewModal=!0}verifyCertificate(e){this.certificateService.verifyCertificate(e.certificateNumber).subscribe({next:a=>{a.isValid?this.toastr.success("Certificate is valid"):this.toastr.warning(a.message||"Certificate is not valid")}})}revokeCertificate(e){let a=prompt("Enter reason for revoking this certificate:");a&&this.certificateService.invalidateCertificate(e.id,a).subscribe({next:t=>{t?(this.toastr.success("Certificate revoked"),this.loadCertificates()):this.toastr.error("Failed to revoke certificate")}})}exportCertificates(){let e=this.certificates();if(e.length===0){this.toastr.warning("No certificates to export");return}let a=["Certificate Number","Student Name","Course Name","Issued Date","Score","Status"],t=e.map(C=>[C.certificateNumber,C.userName,C.courseName,new Date(C.issuedAt).toLocaleDateString(),C.finalScore?`${C.finalScore}%`:"N/A",C.isValid?"Valid":"Revoked"]),c=[a.join(","),...t.map(C=>C.map(Z=>`"${Z}"`).join(","))].join(`
`),u=new Blob([c],{type:"text/csv;charset=utf-8;"}),F=window.URL.createObjectURL(u),k=document.createElement("a");k.href=F,k.download=`certificates-export-${new Date().toISOString().split("T")[0]}.csv`,k.click(),window.URL.revokeObjectURL(F),this.toastr.success("Certificates exported successfully")}downloadCertificate(e){e.pdfUrl?window.open(e.pdfUrl,"_blank"):this.certificateService.downloadCertificate(e.id).subscribe({next:a=>{if(a){let t=window.URL.createObjectURL(a),c=document.createElement("a");c.href=t,c.download=`certificate-${e.certificateNumber}.pdf`,c.click(),window.URL.revokeObjectURL(t)}else this.toastr.info("Certificate PDF not available. Contact admin for generation.")},error:()=>{this.toastr.info("Certificate PDF not available")}})}closeModal(){this.showPreviewModal=!1,this.selectedCertificate=null}getPages(){let e=[],a=Math.min(this.totalPages,5);for(let t=1;t<=a;t++)e.push(t);return e}previousPage(){this.currentPage>1&&(this.currentPage--,this.loadCertificates())}nextPage(){this.currentPage<this.totalPages&&(this.currentPage++,this.loadCertificates())}goToPage(e){this.currentPage=e,this.loadCertificates()}static \u0275fac=function(a){return new(a||s)};static \u0275cmp=I({type:s,selectors:[["app-admin-certificates"]],standalone:!0,features:[j],decls:91,vars:21,consts:[[1,"certificates-page"],[1,"page-header"],[1,"header-left"],[1,"subtitle"],[1,"header-actions"],[1,"export-btn",3,"click"],[1,"stats-row"],[1,"stat-card"],[1,"stat-icon"],[1,"stat-info"],[1,"stat-value"],[1,"stat-label"],[1,"filters-bar"],[1,"search-box"],[1,"search-icon"],["type","text","placeholder","Search certificates...",3,"ngModelChange","ngModel"],[1,"filter-tabs"],[3,"active"],["type","date",3,"ngModelChange","ngModel"],[1,"table-container"],[1,"pagination"],[1,"page-info"],[1,"page-controls"],[3,"click","disabled"],[1,"modal-overlay"],[3,"click"],[1,"cert-number"],[1,"student-cell"],[1,"student-name"],[1,"course-cell"],[1,"course-title"],["class","course-score",4,"ngIf"],[1,"status-badge"],[1,"actions-cell"],["title","View",1,"action-btn",3,"click"],["title","Verify",1,"action-btn",3,"click"],["title","Revoke",1,"action-btn","danger"],[1,"course-score"],["title","Revoke",1,"action-btn","danger",3,"click"],["colspan","7",1,"empty-state"],[1,"modal-overlay",3,"click"],[1,"modal","preview-modal",3,"click"],[1,"modal-header"],[1,"close-btn",3,"click"],[1,"modal-body"],[1,"certificate-preview"],[1,"certificate-frame"],[1,"cert-header"],[1,"cert-body"],[1,"cert-text"],[1,"cert-name"],[1,"cert-course"],[1,"cert-footer"],[1,"cert-info"],[1,"modal-footer"],[1,"download-btn",3,"click"]],template:function(a,t){a&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1"),r(4,"Certificate Management"),n(),i(5,"p",3),r(6,"Manage and verify student certificates"),n()(),i(7,"div",4)(8,"button",5),l("click",function(){return t.exportCertificates()}),i(9,"span"),r(10,"\u{1F4CA}"),n(),r(11," Export "),n()()(),i(12,"div",6)(13,"div",7)(14,"span",8),r(15,"\u{1F3C6}"),n(),i(16,"div",9)(17,"span",10),r(18),_(19,"number"),n(),i(20,"span",11),r(21,"Total Certificates"),n()()(),i(22,"div",7)(23,"span",8),r(24,"\u2705"),n(),i(25,"div",9)(26,"span",10),r(27),_(28,"number"),n(),i(29,"span",11),r(30,"Valid"),n()()(),i(31,"div",7)(32,"span",8),r(33,"\u{1F4C5}"),n(),i(34,"div",9)(35,"span",10),r(36),_(37,"number"),n(),i(38,"span",11),r(39,"This Month"),n()()(),i(40,"div",7)(41,"span",8),r(42,"\u{1F6AB}"),n(),i(43,"div",9)(44,"span",10),r(45),_(46,"number"),n(),i(47,"span",11),r(48,"Revoked"),n()()()(),i(49,"div",12)(50,"div",13)(51,"span",14),r(52,"\u{1F50D}"),n(),i(53,"input",15),T("ngModelChange",function(u){return V(t.searchQuery,u)||(t.searchQuery=u),u}),l("ngModelChange",function(){return t.onSearchChange()}),n()(),i(54,"div",16),S(55,ie,2,3,"button",17,ee),n(),i(57,"input",18),T("ngModelChange",function(u){return V(t.dateFilter,u)||(t.dateFilter=u),u}),l("ngModelChange",function(){return t.filterCertificates()}),n()(),i(58,"div",19)(59,"table")(60,"thead")(61,"tr")(62,"th"),r(63,"Certificate Number"),n(),i(64,"th"),r(65,"Student"),n(),i(66,"th"),r(67,"Course"),n(),i(68,"th"),r(69,"Issued Date"),n(),i(70,"th"),r(71,"Score"),n(),i(72,"th"),r(73,"Status"),n(),i(74,"th"),r(75,"Actions"),n()()(),i(76,"tbody"),S(77,ae,28,14,"tr",null,te,!1,oe,6,0,"tr"),n()()(),i(80,"div",20)(81,"span",21),r(82),n(),i(83,"div",22)(84,"button",23),l("click",function(){return t.previousPage()}),r(85,"\u2190"),n(),S(86,ce,2,3,"button",17,N),i(88,"button",23),l("click",function(){return t.nextPage()}),r(89,"\u2192"),n()()()(),w(90,se,36,7,"div",24)),a&2&&(o(18),f(b(19,13,t.totalCertificates)),o(9),f(b(28,15,t.validCertificates)),o(9),f(b(37,17,t.thisMonthCertificates)),o(9),f(b(46,19,t.revokedCertificates)),o(8),D("ngModel",t.searchQuery),o(2),O(t.statusTabs),o(2),D("ngModel",t.dateFilter),o(20),O(t.filteredCertificates()),o(5),L(" Showing ",(t.currentPage-1)*t.pageSize+1,"-",t.Math.min(t.currentPage*t.pageSize,t.totalCount)," of ",t.totalCount," "),o(2),M("disabled",t.currentPage===1),o(2),O(t.getPages()),o(2),M("disabled",t.currentPage===t.totalPages),o(2),E(t.showPreviewModal&&t.selectedCertificate?90:-1))},dependencies:[Q,B,U,$,K,G,H,J,Y],styles:[".certificates-page[_ngcontent-%COMP%]{padding:2rem;max-width:1400px;margin:0 auto}.page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:2rem}.page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.75rem;font-weight:700;margin-bottom:.25rem}.subtitle[_ngcontent-%COMP%]{color:#666}.export-btn[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:.5rem;padding:.75rem 1.5rem;background:#000;color:#fff;border:none;border-radius:8px;font-weight:600;cursor:pointer}.stats-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(4,1fr);gap:1rem;margin-bottom:2rem}.stat-card[_ngcontent-%COMP%]{background:#fff;border-radius:12px;padding:1.25rem;display:flex;align-items:center;gap:1rem;box-shadow:0 2px 12px #0000000f}.stat-icon[_ngcontent-%COMP%]{font-size:2rem}.stat-value[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;display:block}.stat-label[_ngcontent-%COMP%]{font-size:.85rem;color:#666}.filters-bar[_ngcontent-%COMP%]{display:flex;gap:1rem;margin-bottom:1.5rem;flex-wrap:wrap}.search-box[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;padding:.75rem 1rem;background:#fff;border:2px solid #e0e0e0;border-radius:8px;flex:1;min-width:250px;max-width:350px}.search-box[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{border:none;outline:none;width:100%;font-size:.95rem}.filter-tabs[_ngcontent-%COMP%]{display:flex;gap:.5rem;background:#f8f9fa;padding:.25rem;border-radius:8px}.filter-tabs[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:.625rem 1rem;border:none;background:transparent;border-radius:6px;font-weight:500;cursor:pointer}.filter-tabs[_ngcontent-%COMP%]   button.active[_ngcontent-%COMP%]{background:#fff;box-shadow:0 2px 8px #00000014}input[type=date][_ngcontent-%COMP%]{padding:.75rem 1rem;border:2px solid #e0e0e0;border-radius:8px;font-size:.95rem;background:#fff}.table-container[_ngcontent-%COMP%]{background:#fff;border-radius:16px;box-shadow:0 4px 20px #00000014;overflow:hidden}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}th[_ngcontent-%COMP%]{text-align:left;padding:1rem 1.25rem;background:#f8f9fa;font-weight:600;font-size:.85rem;color:#666}td[_ngcontent-%COMP%]{padding:1rem 1.25rem;border-bottom:1px solid #f0f0f0;vertical-align:middle}tr[_ngcontent-%COMP%]:hover{background:#f8f9fa}.cert-number[_ngcontent-%COMP%]{font-family:monospace;font-weight:600;background:#f0f0f0;padding:.25rem .5rem;border-radius:4px}.student-cell[_ngcontent-%COMP%], .course-cell[_ngcontent-%COMP%]{display:flex;flex-direction:column}.student-name[_ngcontent-%COMP%], .course-title[_ngcontent-%COMP%]{font-weight:600}.student-email[_ngcontent-%COMP%], .course-instructor[_ngcontent-%COMP%]{font-size:.85rem;color:#666}.course-title[_ngcontent-%COMP%]{max-width:200px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.status-badge[_ngcontent-%COMP%]{padding:.25rem .75rem;border-radius:12px;font-size:.8rem;font-weight:600}.status-badge.valid[_ngcontent-%COMP%]{background:#d4edda;color:#155724}.status-badge.revoked[_ngcontent-%COMP%]{background:#f8d7da;color:#721c24}.status-badge.expired[_ngcontent-%COMP%]{background:#fff3cd;color:#856404}.actions-cell[_ngcontent-%COMP%]{display:flex;gap:.25rem}.action-btn[_ngcontent-%COMP%]{width:32px;height:32px;border:none;background:transparent;border-radius:6px;cursor:pointer;font-size:.9rem;transition:background .2s}.action-btn[_ngcontent-%COMP%]:hover{background:#f0f0f0}.action-btn.success[_ngcontent-%COMP%]:hover{background:#d1fae5}.action-btn.danger[_ngcontent-%COMP%]:hover{background:#fee2e2}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:3rem!important;color:#666}.empty-state[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:3rem;display:block;margin-bottom:1rem}.pagination[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-top:1.5rem}.page-info[_ngcontent-%COMP%]{color:#666}.page-controls[_ngcontent-%COMP%]{display:flex;gap:.25rem}.page-controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:36px;height:36px;border:1px solid #e0e0e0;background:#fff;border-radius:6px;cursor:pointer}.page-controls[_ngcontent-%COMP%]   button.active[_ngcontent-%COMP%]{background:#247090;color:#fff;border-color:#247090}.page-controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#00000080;display:flex;align-items:center;justify-content:center;z-index:1000}.modal[_ngcontent-%COMP%]{background:#fff;border-radius:16px;width:100%;max-width:600px}.preview-modal[_ngcontent-%COMP%]{max-width:700px}.modal-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1.5rem;border-bottom:1px solid #e0e0e0}.modal-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:700}.close-btn[_ngcontent-%COMP%]{width:36px;height:36px;border:none;background:#f0f0f0;border-radius:50%;font-size:1.25rem;cursor:pointer}.modal-body[_ngcontent-%COMP%]{padding:1.5rem}.certificate-preview[_ngcontent-%COMP%]{display:flex;justify-content:center}.certificate-frame[_ngcontent-%COMP%]{width:100%;max-width:500px;background:linear-gradient(135deg,#f8f4e6,#fff9e6);border:8px solid;border-image:linear-gradient(135deg,#d4af37,#f4d03f,#d4af37) 1;padding:2rem;text-align:center}.cert-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;margin-bottom:.5rem}.cert-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1rem;color:#666;text-transform:uppercase;letter-spacing:2px}.cert-body[_ngcontent-%COMP%]{padding:1.5rem 0}.cert-text[_ngcontent-%COMP%]{color:#666;margin-bottom:.5rem}.cert-name[_ngcontent-%COMP%]{font-size:1.75rem;font-weight:700;color:#247090;margin:.5rem 0}.cert-course[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600;margin-top:.5rem}.cert-footer[_ngcontent-%COMP%]{margin-top:1.5rem;padding-top:1rem;border-top:1px solid #d4af37}.cert-info[_ngcontent-%COMP%]{display:flex;justify-content:space-between;font-size:.8rem;color:#666}.modal-footer[_ngcontent-%COMP%]{padding:1.5rem;border-top:1px solid #e0e0e0;text-align:center}.download-btn[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:.5rem;padding:.75rem 1.5rem;background:#247090;color:#fff;border:none;border-radius:8px;font-weight:600;cursor:pointer}@media (max-width: 1200px){.stats-row[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr)}}@media (max-width: 768px){.certificates-page[_ngcontent-%COMP%]{padding:1rem}.stats-row[_ngcontent-%COMP%]{grid-template-columns:1fr}.filters-bar[_ngcontent-%COMP%]{flex-direction:column}.search-box[_ngcontent-%COMP%]{max-width:none}.table-container[_ngcontent-%COMP%]{overflow-x:auto}.cert-info[_ngcontent-%COMP%]{flex-direction:column;gap:.5rem}.course-score[_ngcontent-%COMP%]{font-size:.85rem;color:#666}}"]})}return s})();export{xe as AdminCertificatesComponent};
